(this["webpackJsonporderbook-streamer"]=this["webpackJsonporderbook-streamer"]||[]).push([[0],{27:function(e,t,a){e.exports=a(67)},32:function(e,t,a){},65:function(e,t,a){},67:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),i=a(24),o=a.n(i),l=(a(32),function(e){return r.a.createElement("nav",{className:"header navbar navbar-dark bg-dark",style:{overflowX:"hidden"}},r.a.createElement("div",{className:"text-center mx-auto"},r.a.createElement("div",{className:""},r.a.createElement("div",{className:"h3 ml-3 my-auto text-light d-inline-block"},e.title))))});l.defaultProps={title:"App"};var n=a(1),c=a(2),m=a(6),h=a(5),u=a(4),d=a(7),p=a(25),v=a.n(p),f=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).selectExchange=a.selectExchange.bind(Object(u.a)(a)),a.selectFsym=a.selectFsym.bind(Object(u.a)(a)),a.selectTsym=a.selectTsym.bind(Object(u.a)(a)),a.subscribe=a.subscribe.bind(Object(u.a)(a)),a.state={exchanges:{},fSyms:{},tSyms:{},fSym:e.fSym,tSym:e.tSym,exchange:e.exchange},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;v.a.get("https://min-api.cryptocompare.com/data/v4/all/exchanges?topTier=true").then((function(t){e.setState({exchanges:t.data.Data.exchanges}),e.setState({fSyms:e.state.exchanges[e.state.exchange].pairs,tSyms:e.state.exchanges[e.state.exchange].pairs[e.state.fSym].tsyms})}))}},{key:"selectExchange",value:function(e){var t=e.target.value;this.setState({exchange:t,fSyms:this.state.exchanges[t].pairs})}},{key:"selectFsym",value:function(e){var t=e.target.value;this.setState({fSym:t,tSyms:this.state.exchanges[this.state.exchange].pairs[t].tsyms})}},{key:"selectTsym",value:function(e){var t=e.target.value;this.setState({tSym:t})}},{key:"subscribe",value:function(){this.props.subscribe(this.state.exchange,this.state.fSym,this.state.tSym)}},{key:"render",value:function(){return r.a.createElement("div",{className:"subscription row"},r.a.createElement("div",{className:"col-md-2"}),r.a.createElement("select",{className:"browser-default custom-select col-md",value:this.state.exchange,onChange:this.selectExchange,name:"exchanges",id:"exchanges"},Object.keys(this.state.exchanges).map((function(e){return r.a.createElement("option",{key:e},e)}))),r.a.createElement("select",{className:"browser-default custom-select col-md",value:this.state.fSym,onChange:this.selectFsym,name:"fSym",id:"fSym"},Object.keys(this.state.fSyms).map((function(e){return r.a.createElement("option",{key:e},e)}))),r.a.createElement("select",{className:"browser-default custom-select col-md",value:this.state.tSym,onChange:this.selectTsym,name:"tSym",id:"tSym"},Object.keys(this.state.tSyms).map((function(e){return r.a.createElement("option",{key:e},e)}))),r.a.createElement("span",{className:"col-md",onClick:this.subscribe},r.a.createElement("button",{type:"button",className:"btn btn-primary"},"Subscribe")),r.a.createElement("div",{className:"col-md-2"}))}}]),t}(s.Component),b=a(9),y=a.n(b),g=function(){function e(){Object(n.a)(this,e)}return Object(c.a)(e,[{key:"formatNumber",value:function(e,t,a){var s=+e.toFixed(6);return s=s>1e4&&a?y()(s).format("0,0."+"0".repeat(t)+"a"):y()(s).format("0,0."+"0".repeat(t))}}]),e}(),S=(a(50),new g),E=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).handleChange=function(e){a.setState({priceImpactVolume:e.target.value})},a.toggleState=a.toggleState.bind(Object(u.a)(a)),a.toggleDirection=a.toggleDirection.bind(Object(u.a)(a)),a.state={updated:!1,priceImpactVolume:10,toggle:"sell",direction:"to"},a.stats={spread:{midpoint:0,high:0,low:0},depth:{bids:{},asks:{}},impact:{buy:0,sell:0,averageBuyPrice:0,averageSellPrice:0}},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"toggleState",value:function(e){this.setState({toggle:e.target.value})}},{key:"toggleDirection",value:function(e){this.setState({direction:e.target.value})}},{key:"getSpread",value:function(e,t){var a=e[0]/100,s=t[0]/100;return{high:a,low:s,midpoint:parseFloat(a)+(s-a)/2}}},{key:"getDepth",value:function(e,t,a){var s=this.getSpread(e,t).midpoint,r=s-s*(a/100),i=s+s*(a/100),o=0,l=0,n=!0,c=!1,m=void 0;try{for(var h,u=e[Symbol.iterator]();!(n=(h=u.next()).done);n=!0){var d=h.value;d/100>r&&(o+=this.bidsMap[d].bidsvolume,l+=this.bidsMap[d].bidsvolume*this.bidsMap[d].value)}}catch(k){c=!0,m=k}finally{try{n||null==u.return||u.return()}finally{if(c)throw m}}var p=0,v=0,f=!0,b=!1,y=void 0;try{for(var g,S=t[Symbol.iterator]();!(f=(g=S.next()).done);f=!0){var E=g.value;E/100<i&&(p+=this.asksMap[E].asksvolume,v+=this.asksMap[E].asksvolume*this.asksMap[E].value)}}catch(k){b=!0,y=k}finally{try{f||null==S.return||S.return()}finally{if(b)throw y}}return{sell:{to:l,from:o},buy:{to:v,from:p}}}},{key:"getPriceImpact",value:function(e,t){var a={buy:0,sell:0,average:{buy:0,sell:0}};if(!this.state.priceImpactVolume)return a;var s=this.getSpread(e,t).midpoint,r=0,i=0,o=0,l=0,n=this.state.direction,c=!0,m=!1,h=void 0;try{for(var u,d=e[Symbol.iterator]();!(c=(u=d.next()).done);c=!0){var p=u.value;if(a.sell=this.bidsMap[p].value-s,this.bidsMap[p].bidstotalvolume[n]>this.state.priceImpactVolume){r+=(this.state.priceImpactVolume-i)*this.bidsMap[p].value,i=this.bidsMap[p].bidstotalvolume[n];break}i=this.bidsMap[p].bidstotalvolume.to,r+=this.bidsMap[p].bidsvolume*this.bidsMap[p].value}}catch(E){m=!0,h=E}finally{try{c||null==d.return||d.return()}finally{if(m)throw h}}var v=!0,f=!1,b=void 0;try{for(var y,g=t[Symbol.iterator]();!(v=(y=g.next()).done);v=!0){var S=y.value;if(a.buy=this.asksMap[S].value-s,this.asksMap[S].askstotalvolume[n]>this.state.priceImpactVolume){o+=(this.state.priceImpactVolume-l)*this.asksMap[S].value,l=this.asksMap[S].askstotalvolume[n];break}l=this.asksMap[S].askstotalvolume[n],o+=this.asksMap[S].asksvolume*this.asksMap[S].value}}catch(E){f=!0,b=E}finally{try{v||null==g.return||g.return()}finally{if(f)throw b}}return a.average={sell:r/Math.min(i,this.state.priceImpactVolume),buy:o/Math.min(l,this.state.priceImpactVolume)},a}},{key:"getStats",value:function(){var e={};this.bidsMap=this.props.orders[0],this.asksMap=this.props.orders[1];var t=Object.keys(this.props.orders[0]),a=Object.keys(this.props.orders[1]);t.sort((function(e,t){return t-e})),a.sort((function(e,t){return e-t})),e.spread=this.getSpread(t,a),e.depth=this.getDepth(t,a,10),e.impact=this.getPriceImpact(t,a,.5),this.stats=e}},{key:"render",value:function(){return this.props.orders&&Object.keys(this.props.orders[0]).length&&Object.keys(this.props.orders[0]).length?(this.getStats(),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"panel-body"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("form",{className:"switch-field"},r.a.createElement("input",{type:"radio",id:"switch_left",name:"switchToggle",value:"buy",onChange:this.toggleState,checked:"buy"===this.state.toggle}),r.a.createElement("label",{htmlFor:"switch_left"},"Buy"),r.a.createElement("input",{type:"radio",id:"switch_right",name:"switchToggle",value:"sell",onChange:this.toggleState,checked:"sell"===this.state.toggle}),r.a.createElement("label",{htmlFor:"switch_right"},"Sell"))),r.a.createElement("div",{className:"col-md"},r.a.createElement("form",{className:"switch-field direction"},r.a.createElement("input",{type:"radio",id:"switch_direction_to",name:"switchToggle",value:"from",onChange:this.toggleDirection,checked:"from"===this.state.direction}),r.a.createElement("label",{htmlFor:"switch_direction_to"},r.a.createElement("i",{className:"fa fa-exchange"}),"BTC"),r.a.createElement("input",{type:"radio",id:"switch_direction_from",name:"switchToggle",value:"to",onChange:this.toggleDirection,checked:"to"===this.state.direction}),r.a.createElement("label",{htmlFor:"switch_direction_from"},r.a.createElement("i",{className:"fa fa-exchange"}),"USDT")),r.a.createElement("input",{className:"form-control price-impact",type:"text",value:this.state.priceImpactVolume,onChange:this.handleChange})),r.a.createElement("div",{className:"col-md"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md col-stat"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"10% Bid Depth"),r.a.createElement("div",{className:"stat-data"},this.props.fSym," ",S.formatNumber(this.stats.depth[this.state.toggle].from,2,!0),"( ",this.props.tSym," ",S.formatNumber(this.stats.depth[this.state.toggle].to,2,!0)," )"))),r.a.createElement("div",{className:"col-md col-stat"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"Price Impact"),r.a.createElement("div",{className:"stat-data ".concat(this.stats.impact[this.state.toggle]>=0?"up-text":"down-text")},this.props.tSym," ",S.formatNumber(this.stats.impact[this.state.toggle],3,!0)))),r.a.createElement("div",{className:"col-md col-stat"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"Price Impact %"),r.a.createElement("div",{className:"stat-data ".concat(this.stats.impact[this.state.toggle]>=0?"up-text":"down-text")},S.formatNumber(this.stats.impact[this.state.toggle]/this.stats.spread.midpoint*100,3,!0)||0,"%"))),r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"Average Price"),r.a.createElement("div",{className:"stat-data"},this.props.tSym," ",S.formatNumber(this.stats.impact.average[this.state.toggle],2,!0))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"}),r.a.createElement("div",{className:"col-md"},"Highest bid: ",r.a.createElement("span",{className:"up-text"},S.formatNumber(this.stats.spread.high,2,!0))),r.a.createElement("div",{className:"col-md"},r.a.createElement("div",null,"Midpoint: ",S.formatNumber(this.stats.spread.midpoint,3,!0)),r.a.createElement("div",null,"Spread: ",S.formatNumber(this.stats.spread.low-this.stats.spread.high,3,!0))),r.a.createElement("div",{className:"col-md"},"Lowest ask: ",r.a.createElement("span",{className:"down-text"},S.formatNumber(this.stats.spread.low,2,!0))),r.a.createElement("div",{className:"col-md"}))))):r.a.createElement("div",null)}}]),t}(s.Component),k=a(26),N=a.n(k),w=new g,O=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(!this.updated&&-1!==this.props.lastUpdated.indexOf(Number(this.props.order.value))){this.updated=!0;var e=this;setTimeout((function(){e.updated=!1}),100)}return this.price=this.props.order.value,this.volume=this.props.order.bidsvolume||this.props.order.asksvolume,this.tsymPrice=this.props.order.value*(this.props.order.bidsvolume||this.props.order.asksvolume||0),this.totalVolume=this.props.order.bidstotalvolume||this.props.order.askstotalvolume,r.a.createElement("div",{className:"row data-row ".concat(this.updated?"highlight":"")},r.a.createElement("div",{className:"col-md"},w.formatNumber(this.price,2)),r.a.createElement("div",{className:"col-md"},w.formatNumber(this.volume,6)),r.a.createElement("div",{className:"col-md"},w.formatNumber(this.tsymPrice,4,!0)),r.a.createElement("div",{className:"col-md"},w.formatNumber(this.totalVolume.from,2,!0)))}}]),t}(s.Component),j=new g,x=function(e){function t(){return Object(n.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getTableRows",value:function(e){return this.props.keys.map((function(t){return r.a.createElement(O,{lastUpdated:e.lastUpdated,order:e.orders[t],key:t})}))}},{key:"render",value:function(){var e;return this.props.orders&&this.props.keys.length?(e="Buy"===this.props.title?{to:this.props.orders[this.props.keys[this.props.keys.length-1]].bidstotalvolume.to,from:this.props.orders[this.props.keys[this.props.keys.length-1]].bidstotalvolume.from}:{to:this.props.orders[this.props.keys[this.props.keys.length-1]].askstotalvolume.to,from:this.props.orders[this.props.keys[this.props.keys.length-1]].askstotalvolume.from},r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},this.props.fSym," ",j.formatNumber(e.to,2,!0)),r.a.createElement("div",{className:"col-md"},r.a.createElement("h4",null,this.props.title)),r.a.createElement("div",{className:"col-md"},this.props.tSym," ",j.formatNumber(e.from,2,!0))),r.a.createElement("div",{className:"orderbook"},r.a.createElement("div",{className:"row title-row"},r.a.createElement("div",{className:"col-md"},"Price"),r.a.createElement("div",{className:"col-md"},this.props.fSym),r.a.createElement("div",{className:"col-md"},this.props.tSym),r.a.createElement("div",{className:"col-md"},"Sum(",this.props.tSym,")")),r.a.createElement(N.a,{containerHeight:400,elementHeight:21},this.getTableRows(this.props))))):r.a.createElement("div",null)}}]),t}(s.Component),U=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={orders:[],lastUpdated:[]},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(!Object.keys(this.props.orders).length)return r.a.createElement("div",null);var e=Object.keys(this.props.orders[0]),t=Object.keys(this.props.orders[1]);return e.sort((function(e,t){return t-e})),t.sort((function(e,t){return e-t})),r.a.createElement("div",{className:"container"},r.a.createElement(E,{fSym:this.props.fSym,tSym:this.props.tSym,orders:this.props.orders}),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement(x,{fSym:this.props.fSym,tSym:this.props.tSym,orders:this.props.orders[0],keys:e,lastUpdated:this.props.lastUpdated,title:"Buy"})),r.a.createElement("div",{className:"col-md-6"},r.a.createElement(x,{fSym:this.props.fSym,tSym:this.props.tSym,orders:this.props.orders[1],keys:t,lastUpdated:this.props.lastUpdated,title:"Sell"}))))}}]),t}(s.Component),P=a(10),I="df1c3574c94e2c8e04a8c74b07a60b6d2e0279f5a209d81c80973d7bffdd3908",M="wss://streamer.cryptocompare.com/v2?api_key="+I,C=new P.w3cwebsocket(M),T=new(function(){function e(){Object(n.a)(this,e),this.snapshot={0:{},1:{}},this.lastUpdated=[],this.depth=2e6}return Object(c.a)(e,[{key:"processData",value:function(e,t,a){for(var s={},r={},i=0;i<e.length;i++)e[i]={value:Number(e[i].P),volume:Number(e[i][["Q"]])};if(e.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0})),a){for(var o=e.length-1;o>=0;o--){o<e.length-1?e[o].totalvolume={to:e[o+1].totalvolume.to+e[o].volume,from:e[o+1].totalvolume.from+e[o].volume*e[o].value}:e[o].totalvolume={to:e[o].volume,from:e[o].volume*e[o].value};var l={};l.value=e[o].value,l[t+"volume"]=e[o].volume,l[t+"totalvolume"]=e[o].totalvolume,s[100*e[o].value]=l}r={},Object.keys(s).sort((function(e,t){return e-t})).forEach((function(e){r[e]=s[e]}))}else{for(var n=0;n<e.length;n++){e[n].totalvolume=n>0?{to:e[n-1].totalvolume.to+e[n].volume,from:e[n-1].totalvolume.from+e[n].volume*e[n].value}:{to:e[n].volume,from:e[n].volume*e[n].value};var c={};c.value=e[n].value,c[t+"volume"]=e[n].volume,c[t+"totalvolume"]=e[n].totalvolume,s[100*e[n].value]=c}r={},Object.keys(s).sort((function(e,t){return t-e})).forEach((function(e){r[e]=s[e]}))}return r}},{key:"populateSnapshot",value:function(e,t){var a=this;e.BID.map((function(e,t){a.snapshot[0][100*e.P]={Q:e.Q,P:String(e.P)}})),e.ASK.map((function(e,t){a.snapshot[1][100*e.P]={Q:e.Q,P:String(e.P)}})),t({orders:this.getSnapshot(),lastUpdated:this.lastUpdated})}},{key:"getLastUpdated",value:function(){return this.lastUpdated}},{key:"resetLastUpdated",value:function(){this.lastUpdated=[]}},{key:"resetSnapshot",value:function(){this.snapshot={0:{},1:{}}}},{key:"getSnapshot",value:function(){var e=Object.keys(this.snapshot[0]).sort().slice(-this.depth),t=[],a=!0,s=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var l=i.value;t.push(this.snapshot[0][l])}}catch(f){s=!0,r=f}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}var n=Object.keys(this.snapshot[1]).slice(0,this.depth),c=[],m=!0,h=!1,u=void 0;try{for(var d,p=n[Symbol.iterator]();!(m=(d=p.next()).done);m=!0){var v=d.value;c.push(this.snapshot[1][v])}}catch(f){h=!0,u=f}finally{try{m||null==p.return||p.return()}finally{if(h)throw u}}return{0:this.processData(t,"bids",!0),1:this.processData(c,"asks",!1)}}},{key:"updateSnapshot",value:function(e,t){1===e.ACTION&&(this.snapshot[e.SIDE][100*e.P]={P:e.P,Q:e.Q},this.lastUpdated.push(e.P)),void 0!==this.snapshot[e.SIDE][100*e.P]?(2===e.ACTION&&delete this.snapshot[e.SIDE][100*e.P],4===e.ACTION&&(this.snapshot[e.SIDE][100*e.P].Q=e.Q,this.lastUpdated.push(e.P))):console.error("No price ",e.P," found on side ",e.SIDE," to perform action ",e.ACTION)}},{key:"subscribe",value:function(e,t,a,s){var r=this;console.log("Subscribing",e,a,t,C),(C=null==C?new P.w3cwebsocket(M):C).onopen=function(){C.send(JSON.stringify({action:"SubAdd",subs:["8~"+e+"~"+t+"~"+a],api_key:I}))},C.onmessage=function(e){if(e.data){var t=JSON.parse(e.data);"9"===t.TYPE&&r.populateSnapshot(t,s),"8"===t.TYPE&&r.updateSnapshot(t)}}}},{key:"unsubscribe",value:function(e){console.log("Unsubscribing"),this.resetLastUpdated(),this.resetSnapshot(),C.close(),C=null}}]),e}()),D=function(e){function t(e){var a;Object(n.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).changeSubscription=a.changeSubscription.bind(Object(u.a)(a)),a.state={orders:{},lastUpdated:[],exchange:e.exchange,fSym:e.fSym,tSym:e.tSym};var s=Object(u.a)(a);return setInterval((function(){s.setState((function(e){return{orders:T.getSnapshot(),lastUpdated:T.getLastUpdated()}})),T.resetLastUpdated()}),150),a.subscribe(a.state.exchange,a.state.fSym,a.state.tSym),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"subscribe",value:function(e,t,a){var s=this;this.callback=function(e){s.setState((function(t){return{orders:e.orders,lastUpdated:T.getLastUpdated()}})),T.resetLastUpdated()},T.subscribe(e,t,a,this.callback)}},{key:"changeSubscription",value:function(e,t,a){T.unsubscribe(),this.setState({exchange:e,fSym:t,tSym:a}),this.subscribe(e,t,a)}},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement(f,{subscribe:this.changeSubscription,exchange:this.state.exchange,fSym:this.state.fSym,tSym:this.state.tSym}),r.a.createElement(U,{fSym:this.state.fSym,tSym:this.state.tSym,orders:this.state.orders,lastUpdated:this.state.lastUpdated}))}}]),t}(s.Component);a(65),a(66);var _=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(l,{title:"CryptoCompare Orderbook L2 Streamer"}),r.a.createElement(D,{exchange:"Binance",fSym:"BTC",tSym:"USDT"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(_,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.5da48003.chunk.js.map