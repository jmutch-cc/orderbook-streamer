(this["webpackJsonporderbook-streamer"]=this["webpackJsonporderbook-streamer"]||[]).push([[0],{127:function(e,t,a){e.exports=a(151)},132:function(e,t,a){},148:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},149:function(e,t,a){},151:function(e,t,a){"use strict";a.r(t);var s=a(15),r=a.n(s),o=a(122),l=a.n(o),i=(a(132),function(e){return r.a.createElement("nav",{className:"header navbar navbar-dark bg-dark",style:{overflowX:"hidden"}},r.a.createElement("div",{className:"text-center mx-auto"},r.a.createElement("div",{className:""},r.a.createElement("div",{className:"h3 ml-3 my-auto text-light d-inline-block"},e.title))))});i.defaultProps={title:"App"};var n=a(45),c=a(46),m=a(55),u=a(53),d=a(56),h=function(e){return r.a.createElement("div",{className:"subscription"})},p=a(95),v=a(77),f=a(66),b=a(126);v.c(b.a);s.Component;var g=a(116),y=a.n(g),E=function(){function e(){Object(n.a)(this,e)}return Object(c.a)(e,[{key:"formatNumber",value:function(e,t,a){var s=+e.toFixed(6);return s=s>1e4&&a?y()(s).format("0,0."+"0".repeat(t)+"a"):y()(s).format("0,0."+"0".repeat(t))}}]),e}(),N=(a(133),new E),k=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){a.setState({priceImpactVolume:e.target.value})},a.toggleState=a.toggleState.bind(Object(p.a)(a)),a.toggleDirection=a.toggleDirection.bind(Object(p.a)(a)),a.state={updated:!1,priceImpactVolume:10,toggle:"sell",direction:"to"},a.stats={spread:{midpoint:0,high:0,low:0},depth:{bids:{},asks:{}},impact:{buy:0,sell:0,averageBuyPrice:0,averageSellPrice:0}},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"toggleState",value:function(e){this.setState({toggle:e.target.value})}},{key:"toggleDirection",value:function(e){this.setState({direction:e.target.value})}},{key:"getSpread",value:function(e,t){var a=e[0]/100,s=t[0]/100;return{high:a,low:s,midpoint:parseFloat(a)+(s-a)/2}}},{key:"getDepth",value:function(e,t,a){var s=this.getSpread(e,t).midpoint,r=s-s*(a/100),o=s+s*(a/100),l=0,i=0,n=!0,c=!1,m=void 0;try{for(var u,d=e[Symbol.iterator]();!(n=(u=d.next()).done);n=!0){var h=u.value;h/100>r&&(l+=this.bidsMap[h].bidsvolume,i+=this.bidsMap[h].bidsvolume*this.bidsMap[h].value)}}catch(k){c=!0,m=k}finally{try{n||null==d.return||d.return()}finally{if(c)throw m}}var p=0,v=0,f=!0,b=!1,g=void 0;try{for(var y,E=t[Symbol.iterator]();!(f=(y=E.next()).done);f=!0){var N=y.value;N/100<o&&(p+=this.asksMap[N].asksvolume,v+=this.asksMap[N].asksvolume*this.asksMap[N].value)}}catch(k){b=!0,g=k}finally{try{f||null==E.return||E.return()}finally{if(b)throw g}}return{sell:{to:i,from:l},buy:{to:v,from:p}}}},{key:"getPriceImpact",value:function(e,t){var a={buy:0,sell:0,average:{buy:0,sell:0}};if(!this.state.priceImpactVolume)return a;var s=this.getSpread(e,t).midpoint,r=0,o=0,l=0,i=0,n=this.state.direction,c=!0,m=!1,u=void 0;try{for(var d,h=e[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var p=d.value;if(a.sell=this.bidsMap[p].value-s,this.bidsMap[p].bidstotalvolume[n]>this.state.priceImpactVolume){r+=(this.state.priceImpactVolume-o)*this.bidsMap[p].value,o=this.bidsMap[p].bidstotalvolume[n];break}o=this.bidsMap[p].bidstotalvolume.to,r+=this.bidsMap[p].bidsvolume*this.bidsMap[p].value}}catch(N){m=!0,u=N}finally{try{c||null==h.return||h.return()}finally{if(m)throw u}}var v=!0,f=!1,b=void 0;try{for(var g,y=t[Symbol.iterator]();!(v=(g=y.next()).done);v=!0){var E=g.value;if(a.buy=this.asksMap[E].value-s,this.asksMap[E].askstotalvolume[n]>this.state.priceImpactVolume){l+=(this.state.priceImpactVolume-i)*this.asksMap[E].value,i=this.asksMap[E].askstotalvolume[n];break}i=this.asksMap[E].askstotalvolume[n],l+=this.asksMap[E].asksvolume*this.asksMap[E].value}}catch(N){f=!0,b=N}finally{try{v||null==y.return||y.return()}finally{if(f)throw b}}return a.average={sell:r/Math.min(o,this.state.priceImpactVolume),buy:l/Math.min(i,this.state.priceImpactVolume)},a}},{key:"getStats",value:function(){var e={};this.bidsMap=this.props.orders[0],this.asksMap=this.props.orders[1];var t=Object.keys(this.props.orders[0]),a=Object.keys(this.props.orders[1]);t.sort((function(e,t){return t-e})),a.sort((function(e,t){return e-t})),e.spread=this.getSpread(t,a),e.depth=this.getDepth(t,a,10),e.impact=this.getPriceImpact(t,a,.5),this.stats=e}},{key:"render",value:function(){return this.props.orders&&Object.keys(this.props.orders[0]).length&&Object.keys(this.props.orders[0]).length?(this.getStats(),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"panel-body"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("form",{className:"switch-field"},r.a.createElement("input",{type:"radio",id:"switch_left",name:"switchToggle",value:"buy",onChange:this.toggleState,checked:"buy"==this.state.toggle}),r.a.createElement("label",{htmlFor:"switch_left"},"Buy"),r.a.createElement("input",{type:"radio",id:"switch_right",name:"switchToggle",value:"sell",onChange:this.toggleState,checked:"sell"==this.state.toggle}),r.a.createElement("label",{htmlFor:"switch_right"},"Sell"))),r.a.createElement("div",{className:"col-md"},r.a.createElement("form",{className:"switch-field direction"},r.a.createElement("input",{type:"radio",id:"switch_direction_to",name:"switchToggle",value:"from",onChange:this.toggleDirection,checked:"from"==this.state.direction}),r.a.createElement("label",{htmlFor:"switch_direction_to"},r.a.createElement("i",{className:"fa fa-exchange"}),"BTC"),r.a.createElement("input",{type:"radio",id:"switch_direction_from",name:"switchToggle",value:"to",onChange:this.toggleDirection,checked:"to"==this.state.direction}),r.a.createElement("label",{htmlFor:"switch_direction_from"},r.a.createElement("i",{className:"fa fa-exchange"}),"USDT")),r.a.createElement("input",{className:"form-control price-impact",type:"text",value:this.state.priceImpactVolume,onChange:this.handleChange})),r.a.createElement("div",{className:"col-md"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md col-stat"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"10% Bid Depth"),r.a.createElement("div",{className:"stat-data"},"\u0243 ",N.formatNumber(this.stats.depth[this.state.toggle].from,2,!0),"( \u20ae ",N.formatNumber(this.stats.depth[this.state.toggle].to,2,!0)," )"))),r.a.createElement("div",{className:"col-md col-stat"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"Price Impact"),r.a.createElement("div",{className:"stat-data ".concat(this.stats.impact[this.state.toggle]>=0?"up-text":"down-text")},"\u20ae ",N.formatNumber(this.stats.impact[this.state.toggle],3,!0)))),r.a.createElement("div",{className:"col-md col-stat"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"Price Impact %"),r.a.createElement("div",{className:"stat-data ".concat(this.stats.impact[this.state.toggle]>=0?"up-text":"down-text")},N.formatNumber(this.stats.impact[this.state.toggle]/this.stats.spread.midpoint*100,3,!0)||0,"%"))),r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"stat-wrapper"},r.a.createElement("div",{className:"stat-label"},"Average Price"),r.a.createElement("div",{className:"stat-data"},"\u20ae ",N.formatNumber(this.stats.impact.average[this.state.toggle],2,!0))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"}),r.a.createElement("div",{className:"col-md"},"Highest bid: ",r.a.createElement("span",{className:"up-text"},N.formatNumber(this.stats.spread.high,2,!0))),r.a.createElement("div",{className:"col-md"},r.a.createElement("div",null,"Midpoint: ",N.formatNumber(this.stats.spread.midpoint,3,!0)),r.a.createElement("div",null,"Spread: ",N.formatNumber(this.stats.spread.low-this.stats.spread.high,3,!0))),r.a.createElement("div",{className:"col-md"},"Lowest ask: ",r.a.createElement("span",{className:"down-text"},N.formatNumber(this.stats.spread.low,2,!0))),r.a.createElement("div",{className:"col-md"}))))):r.a.createElement("div",null)}}]),t}(s.Component),w=a(124),S=a.n(w),O=new E,j=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(!this.updated&&-1!==this.props.lastUpdated.indexOf(Number(this.props.order.value))){this.updated=!0;var e=this;setTimeout((function(){e.updated=!1}),100)}return this.price=this.props.order.value,this.volume=this.props.order.bidsvolume||this.props.order.asksvolume,this.tsymPrice=this.props.order.value*(this.props.order.bidsvolume||this.props.order.asksvolume||0),this.totalVolume=this.props.order.bidstotalvolume||this.props.order.askstotalvolume,r.a.createElement("div",{className:"row data-row ".concat(this.updated?"highlight":"")},r.a.createElement("div",{className:"col-md"},O.formatNumber(this.price,2)),r.a.createElement("div",{className:"col-md"},O.formatNumber(this.volume,6)),r.a.createElement("div",{className:"col-md"},O.formatNumber(this.tsymPrice,4,!0)),r.a.createElement("div",{className:"col-md"},O.formatNumber(this.totalVolume.from,2,!0)))}}]),t}(s.Component),U=new E,P=function(e){function t(){return Object(n.a)(this,t),Object(m.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getTableRows",value:function(e){return"Buy"===e.title?this.orderKeys.sort((function(e,t){return t-e})):this.orderKeys.sort((function(e,t){return e-t})),this.orderKeys.map((function(t){return r.a.createElement(j,{lastUpdated:e.lastUpdated,order:e.orders[t],key:t})}))}},{key:"render",value:function(){if(!this.props.orders)return r.a.createElement("div",null);var e=Object.keys(this.props.orders);if(!e.length)return r.a.createElement("div",null);if("Buy"===this.props.title){e.sort((function(e,t){return t-e}));var t={to:this.props.orders[e[e.length-1]].bidstotalvolume.to,from:this.props.orders[e[e.length-1]].bidstotalvolume.from}}else{e.sort((function(e,t){return e-t}));t={to:this.props.orders[e[e.length-1]].askstotalvolume.to,from:this.props.orders[e[e.length-1]].askstotalvolume.from}}return this.orderKeys=e,r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},"\u0243 ",U.formatNumber(t.to,2,!0)),r.a.createElement("div",{className:"col-md"},r.a.createElement("h4",null,this.props.title)),r.a.createElement("div",{className:"col-md"},"\u20ae ",U.formatNumber(t.from,2,!0))),r.a.createElement("div",{className:"orderbook"},r.a.createElement("div",{className:"row title-row"},r.a.createElement("div",{className:"col-md"},"Price"),r.a.createElement("div",{className:"col-md"},"BTC"),r.a.createElement("div",{className:"col-md"},"USDT"),r.a.createElement("div",{className:"col-md"},"Sum(USDT)")),r.a.createElement(S.a,{containerHeight:400,elementHeight:21},this.getTableRows(this.props))))}}]),t}(s.Component),I=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(u.a)(t).call(this,e))).state={orders:[],lastUpdated:[]},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t,a){return!0}},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement(k,{orders:this.props.orders}),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement(P,{orders:this.props.orders[0],lastUpdated:this.props.lastUpdated,title:"Buy"})),r.a.createElement("div",{className:"col-md-6"},r.a.createElement(P,{orders:this.props.orders[1],lastUpdated:this.props.lastUpdated,title:"Sell"}))))}}]),t}(s.Component),M=new(a(125).w3cwebsocket)("wss://streamer.cryptocompare.com/v2?api_key=66cdac0fc6a565b41a9ecd3549784e14fdc851c2f2bc88f7f1f18019b170cd44"),x=new(function(){function e(){Object(n.a)(this,e),this.snapshot={0:{},1:{}},this.lastUpdated=[],this.depth=2e6}return Object(c.a)(e,[{key:"processData",value:function(e,t,a){for(var s={},r=0;r<e.length;r++)e[r]={value:Number(e[r].P),volume:Number(e[r][["Q"]])};if(e.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0})),a){for(r=e.length-1;r>=0;r--){r<e.length-1?e[r].totalvolume={to:e[r+1].totalvolume.to+e[r].volume,from:e[r+1].totalvolume.from+e[r].volume*e[r].value}:e[r].totalvolume={to:e[r].volume,from:e[r].volume*e[r].value};var o={};o.value=e[r].value,o[t+"volume"]=e[r].volume,o[t+"totalvolume"]=e[r].totalvolume,s[100*e[r].value]=o}var l={};Object.keys(s).sort((function(e,t){return e-t})).forEach((function(e){l[e]=s[e]}))}else{for(r=0;r<e.length;r++){e[r].totalvolume=r>0?{to:e[r-1].totalvolume.to+e[r].volume,from:e[r-1].totalvolume.from+e[r].volume*e[r].value}:{to:e[r].volume,from:e[r].volume*e[r].value};var i={};i.value=e[r].value,i[t+"volume"]=e[r].volume,i[t+"totalvolume"]=e[r].totalvolume,s[100*e[r].value]=i}l={};Object.keys(s).sort((function(e,t){return t-e})).forEach((function(e){l[e]=s[e]}))}return l}},{key:"populateSnapshot",value:function(e,t){var a=this;e.BID.map((function(e,t){a.snapshot[0][100*e.P]={Q:e.Q,P:String(e.P)}})),e.ASK.map((function(e,t){a.snapshot[1][100*e.P]={Q:e.Q,P:String(e.P)}}));var s=Object.keys(this.snapshot[0]).sort().slice(-this.depth),r=[],o=!0,l=!1,i=void 0;try{for(var n,c=s[Symbol.iterator]();!(o=(n=c.next()).done);o=!0){var m=n.value;r.push(this.snapshot[0][m])}}catch(y){l=!0,i=y}finally{try{o||null==c.return||c.return()}finally{if(l)throw i}}var u=Object.keys(this.snapshot[1]).slice(0,this.depth),d=[],h=!0,p=!1,v=void 0;try{for(var f,b=u[Symbol.iterator]();!(h=(f=b.next()).done);h=!0){var g=f.value;d.push(this.snapshot[1][g])}}catch(y){p=!0,v=y}finally{try{h||null==b.return||b.return()}finally{if(p)throw v}}t({orders:{0:this.processData(r,"bids",!0),1:this.processData(d,"asks",!1)},lastUpdated:this.lastUpdated})}},{key:"getLastUpdated",value:function(){return this.lastUpdated}},{key:"resetLastUpdated",value:function(){this.lastUpdated=[]}},{key:"getSnapshot",value:function(){var e=Object.keys(this.snapshot[0]).sort().slice(-this.depth),t=[],a=!0,s=!1,r=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var i=o.value;t.push(this.snapshot[0][i])}}catch(f){s=!0,r=f}finally{try{a||null==l.return||l.return()}finally{if(s)throw r}}var n=Object.keys(this.snapshot[1]).slice(0,this.depth),c=[],m=!0,u=!1,d=void 0;try{for(var h,p=n[Symbol.iterator]();!(m=(h=p.next()).done);m=!0){var v=h.value;c.push(this.snapshot[1][v])}}catch(f){u=!0,d=f}finally{try{m||null==p.return||p.return()}finally{if(u)throw d}}return{0:this.processData(t,"bids",!0),1:this.processData(c,"asks",!1)}}},{key:"updateSnapshot",value:function(e,t){1==e.ACTION&&(this.snapshot[e.SIDE][100*e.P]={P:e.P,Q:e.Q},this.lastUpdated.push(e.P)),void 0!=this.snapshot[e.SIDE][100*e.P]?(2==e.ACTION&&delete this.snapshot[e.SIDE][100*e.P],4==e.ACTION&&(this.snapshot[e.SIDE][100*e.P].Q=e.Q,this.lastUpdated.push(e.P))):console.error("No price ",e.P," found on side ",e.SIDE," to perform action ",e.ACTION)}},{key:"subscribe",value:function(e){var t=this;console.log("Subscribing"),M.onopen=function(){M.send(JSON.stringify({action:"SubAdd",subs:["8~Binance~BTC~USDT"],api_key:"66cdac0fc6a565b41a9ecd3549784e14fdc851c2f2bc88f7f1f18019b170cd44"}))},M.onmessage=function(a){if(a.data){var s=JSON.parse(a.data);9==s.TYPE&&t.populateSnapshot(s,e),8==s.TYPE&&t.updateSnapshot(s)}}}},{key:"unsubscribe",value:function(e){console.log("Unsubscribing"),M.close()}}]),e}()),C=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(u.a)(t).call(this,e))).state={orders:0,lastUpdated:0},a.subscribe(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"subscribe",value:function(){var e=this,t=this;setInterval((function(){t.setState((function(e){return{orders:x.getSnapshot(),lastUpdated:x.getLastUpdated()}})),x.resetLastUpdated()}),100),t.callback=function(t){e.setState((function(e){return{orders:t.orders,lastUpdated:x.getLastUpdated()}})),x.resetLastUpdated()},x.subscribe(t.callback)}},{key:"changeSubscription",value:function(e){}},{key:"handleUnsubscribe",value:function(e){x.unsubscribe()}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(h,{subscribe:this.changeSubscription.bind(this)}),r.a.createElement(I,{orders:this.state.orders,lastUpdated:this.state.lastUpdated}))}}]),t}(s.Component);a(148),a(149),a(150);var D=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(i,{title:"CryptoCompare Orderbook L2 Streamer"}),r.a.createElement(C,{lastUpdated:0}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[127,1,3]]]);
//# sourceMappingURL=main.25a27a40.chunk.js.map